<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Monatskalender mit Türchen - Eine installierbare Progressive Web App">
    <meta name="theme-color" content="#FFB84D">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self'; img-src 'self' data:; connect-src 'self'">

    <!-- PWA Meta Tags -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" href="assets/icons/icon.svg">
    <link rel="apple-touch-icon" href="assets/icons/icon-192.png">

    <title>Monatskalender mit Türchen</title>

    <!-- CSS -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Ladeanimation -->
    <div id="loading-spinner" class="loading-spinner">
        <div class="spinner"></div>
        <p>Lade Kalender...</p>
    </div>

    <!-- Fallback für deaktiviertes JavaScript -->
    <noscript>
        <div class="noscript-warning">
            <h2>⚠️ JavaScript erforderlich</h2>
            <p>Diese App benötigt JavaScript. Bitte aktiviere JavaScript in deinen Browser-Einstellungen.</p>
        </div>
    </noscript>
    <!-- Header -->
    <header class="app-header">
        <h1>Monatskalender mit Türchen</h1>
        <p class="subtitle">Entdecke jeden Tag eine neue Lebensweisheit</p>
    </header>

    <!-- Main Container -->
    <main class="container">
        <!-- Info-Banner für gesperrte Türchen -->
        <div class="info-banner" id="info-banner" role="status" aria-live="polite" style="display: none;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="16" x2="12" y2="12"></line>
                <line x1="12" y1="8" x2="12.01" y2="8"></line>
            </svg>
            <span id="info-banner-text"></span>
        </div>

        <!-- Calendar Grid -->
        <div class="calendar-wrapper">
            <!-- Background Illustration -->
            <div class="month-illustration" id="month-illustration" aria-hidden="true"></div>

            <!-- Calendar Grid -->
            <div class="calendar-grid" id="calendar-grid" role="grid" aria-label="Kalender-Türchen">
                <!-- Generated dynamically by JavaScript -->
            </div>
        </div>

        <!-- Month Selection -->
        <div class="month-selector">
            <label for="month-select" class="visually-hidden">Monat auswählen</label>
            <select id="month-select" class="month-dropdown" aria-label="Monat auswählen">
                <option value="0">Januar</option>
                <option value="1">Februar</option>
                <option value="2">März</option>
                <option value="3">April</option>
                <option value="4">Mai</option>
                <option value="5">Juni</option>
                <option value="6">Juli</option>
                <option value="7">August</option>
                <option value="8">September</option>
                <option value="9">Oktober</option>
                <option value="10">November</option>
                <option value="11">Dezember</option>
            </select>

            <div class="current-month-year" id="current-month-year"></div>

            <button class="shuffle-btn" id="shuffle-btn" aria-label="Sprüche neu mischen">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M16 3h5v5M4 20L21 3M21 16v5h-5M15 15l6 6M4 4l5 5"/>
                </svg>
                <span>Sprüche mischen</span>
            </button>
        </div>
    </main>

    <!-- Modal for Quote Display -->
    <div class="modal" id="quote-modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <div class="modal-backdrop" id="modal-backdrop"></div>
        <div class="modal-content">
            <button class="modal-close" id="modal-close" aria-label="Schließen">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            <h2 id="modal-title">Historische Lebensweisheit</h2>
            <div class="modal-body">
                <p id="quote-text" class="quote-text"></p>
                <div class="quote-author-section">
                    <div class="quote-author" id="quote-author"></div>
                    <div class="quote-dates" id="quote-dates"></div>
                </div>
                <div class="modal-day" id="modal-day"></div>
                <a href="#" id="quote-link" class="quote-link-btn" target="_blank" rel="noopener noreferrer" style="display: none;">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                        <polyline points="15 3 21 3 21 9"></polyline>
                        <line x1="10" y1="14" x2="21" y2="3"></line>
                    </svg>
                    <span id="quote-link-title">Mehr erfahren</span>
                </a>
            </div>
        </div>
    </div>

    <!-- Locked Door Message -->
    <div class="toast" id="toast" role="status" aria-live="polite"></div>

    <!-- Scripts -->
    <script src="js/quotes.js"></script>
    <script src="js/app.js"></script>

    <!-- PWA Registration + Error Handling -->
    <script>
        // Global Error Handler
        window.addEventListener('error', (event) => {
            console.error('Unerwarteter Fehler:', event.error);
            const toast = document.getElementById('toast');
            if (toast) {
                toast.textContent = '⚠️ Ein Fehler ist aufgetreten. Bitte lade die Seite neu.';
                toast.classList.add('show');
                setTimeout(() => toast.classList.remove('show'), 5000);
            }
        });

        window.addEventListener('unhandledrejection', (event) => {
            console.error('Unbehandeltes Promise:', event.reason);
        });

        // Ladeanimation wird von der App entfernt, sobald sie vollständig initialisiert ist

        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registriert:', registration.scope);
                    })
                    .catch(error => {
                        console.log('Service Worker Registrierung fehlgeschlagen:', error);
                    });
            });
        }
    </script>
</body>
</html>
